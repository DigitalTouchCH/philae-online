<div class="container">
  <div >
    <div class="mb-5">
      <div class="row">
        <h1> Gestion des disponibilitées </h1>
    </div>

    <div class="mb-5">
      <div data-controller="toggle">
        <% @week_availabilities.each do |week_availability| %>
          <div class="mb-5">
            <div class="text-center">
              <%= t('hello') %>
              <%= week_availability.therapist.first_name %> <%= week_availability.therapist.last_name.upcase %>
              De <strong><%= week_availability.valid_from.strftime('%A %d %B %Y') %></strong> à <strong><%= week_availability.valid_until.strftime('%A %d %B %Y') %></strong>
              <%= link_to new_week_availability_time_block_path(week_availability), class: 'float-right ml-2' do %>
                  <i class="fas fas-black fa-plus" title="Add Time Block"></i>
              <% end %>
              <%= link_to edit_week_availability_path(week_availability), class: 'float-right ml-2' do %>
                <i class="fas fas-black fa-edit" title="Edit"></i>
              <% end %>
              <%= link_to week_availability_path(week_availability), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"}, class: 'float-right ml-2' do %>
                <i class="fas fas-black fa-trash-alt" title="Delete"></i>
              <% end %>
              <button data-action="toggle#toggle" class="btn btn-sm float-right">
                <i class="fas fas-black fa-eye" data-toggle-icon></i>
              </button>
            </div>
            <div data-toggle-target="content">
              <table class="table table-transparent" style="height: 500px;">
                <thead>
                  <tr>
                    <% @days = ["Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi", "Dimanche"] %>
                    <% @days.each do |day| %>
                      <th style="width: 14.28%;"><%= day %></th>
                    <% end %>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <% @days.each do |day| %>
                      <td>
                        <% time_blocks_for_day = week_availability.time_blocks.where(week_day: day) %>
                        <% time_blocks_for_day.each do |time_block| %>
                          <div class="time-block-card" style="height: <%= height_percentage(time_block.start_time, time_block.end_time) %>%; top: <%= top_position(time_block.start_time) %>%;">
                              <div>
                                  <p>
                                      <strong><%= "#{time_block.start_time.strftime('%H:%M')} to #{time_block.end_time.strftime('%H:%M')}" %></strong>
                                      <br>
                                      <%= time_block.room.name %>
                                      <br>
                                      <%= link_to edit_week_availability_time_block_path(week_availability, time_block) do %>
                                          <i class="fas fas-black fa-edit" title="Edit"></i>
                                      <% end %>
                                      <%= link_to week_availability_time_block_path(week_availability, time_block), data: {turbo_method: :delete, turbo_confirm: "Are you sure?"} do %>
                                          <i class="fas fas-black fa-trash-alt" title="Delete"></i>
                                      <% end %>
                                  </p>
                              </div>
                          </div>
                        <% end %>
                      </td>
                    <% end %>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        <% end %>
      </div>
  </div>
</div>
